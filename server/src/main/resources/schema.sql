DROP TABLE IF EXISTS USERS;
DROP TABLE IF EXISTS REQUESTS;
DROP TABLE IF EXISTS ITEMS;


CREATE TABLE IF NOT EXISTS USERS
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    EMAIL CHARACTER VARYING(50)                   NOT NULL,
    NAME  CHARACTER VARYING(50)                   NOT NULL,
    CONSTRAINT USERS_PK PRIMARY KEY (ID),
    CONSTRAINT UNIQUE_EMAIL UNIQUE (EMAIL)
);


CREATE TABLE IF NOT EXISTS REQUESTS
(
    ID          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    DESCRIPTION CHARACTER VARYING(50),
    USER_ID     INTEGER,
    DATE_CREATE DATE,
    CONSTRAINT REQUESTS_PK PRIMARY KEY (ID),
    CONSTRAINT CONSTRAINT_REQUESTS_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (ID)
);

CREATE TABLE IF NOT EXISTS ITEMS
(
    ID          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME        CHARACTER VARYING(50)  NOT NULL,
    DESCRIPTION CHARACTER VARYING(50)  NOT NULL,
    AVIABLE     BOOLEAN DEFAULT FALSE  NOT NULL,
    REQUEST_ID  INTEGER,
    USER_ID     INTEGER ,
    CONSTRAINT ITEMS_PK PRIMARY KEY (ID),
    CONSTRAINT CONSTRAINT_ITEMS_REQUEST_ID FOREIGN KEY (REQUEST_ID) REFERENCES REQUESTS (ID) on delete cascade on update cascade,
    CONSTRAINT CONSTRAINT_ITEMS_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (ID) on delete cascade on update cascade
);

CREATE TABLE IF NOT EXISTS BOOKING
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    DATE_BEGIN  TIMESTAMP,
    DATE_END  TIMESTAMP,
    USER_ID     INTEGER ,
    ITEM_ID     INTEGER ,
    STATUS CHARACTER VARYING(50),
    CONSTRAINT BOOKING_PK PRIMARY KEY (ID),
    CONSTRAINT CONSTRAINT_BOOKING_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (ID) on delete cascade on update cascade,
    CONSTRAINT CONSTRAINT_BOOKING_ITEM_ID FOREIGN KEY (ITEM_ID) REFERENCES ITEMS (ID) on delete cascade on update cascade
);

CREATE TABLE IF NOT EXISTS COMMENTS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    text CHARACTER VARYING(50),
    USER_ID     INTEGER ,
    ITEM_ID     INTEGER ,
    DATE_CREATED  TIMESTAMP,
    CONSTRAINT COMMENTS_PK PRIMARY KEY (ID),
    CONSTRAINT CONSTRAINT_COMMENTS_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (ID) on delete cascade on update cascade,
    CONSTRAINT CONSTRAINT_COMMENTS_ITEM_ID FOREIGN KEY (ITEM_ID) REFERENCES ITEMS (ID) on delete cascade on update cascade
);

